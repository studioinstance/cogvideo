# cogvideo

A pinokio script for https://github.com/THUDM/CogVideo

## メモリ・ディスク不足の対処方法

### メモリ不足の場合

1. **Web UIでの設定調整**
   - **推論ステップ数**: デフォルトは15（低リソース環境向け）。さらに減らす場合は10以下を推奨
   - **フレーム数**: デフォルトは13（低リソース環境向け）。さらに減らす場合は9以下を推奨
   - **データ型**: `float16`を選択（デフォルト）
   - **モデル**: `CogVideoX-2b`を選択（5bよりメモリ使用量が少ない）

2. **環境変数の設定**
   - `start.js`で既に最適化された環境変数が設定されています：
     - `PYTORCH_CUDA_ALLOC_CONF`: GPUメモリの割り当てを最適化
     - `OMP_NUM_THREADS`, `MKL_NUM_THREADS`: CPUスレッド数を制限

3. **推奨設定（低リソース環境）**
   - 推論ステップ数: 10-15
   - フレーム数: 9-13
   - データ型: float16
   - モデル: CogVideoX-2b

### ディスク不足の場合

1. **自動クリーンアップ**
   - 生成された動画ファイルは5分以上経過すると自動削除されます
   - ディスク容量が1GB未満の場合、2分以上経過したファイルが削除されます
   - ディスク容量が0.5GB未満の場合、さらに積極的に削除されます

2. **手動クリーンアップ**
   - `app/inference/output`フォルダ内の古い動画ファイルを手動で削除できます
   - `app/inference/gradio_tmp`フォルダ内の一時ファイルも削除できます

3. **キャッシュの削除**
   - Hugging Faceモデルのキャッシュ: `cache/HF_HOME`フォルダ
   - PyTorchのキャッシュ: `cache/TORCH_HOME`フォルダ
   - これらのフォルダを削除すると、次回起動時にモデルを再ダウンロードする必要があります

### トラブルシューティング

- **GPUメモリ不足エラーが発生した場合**:
  1. フレーム数を9に減らす
  2. 推論ステップ数を10に減らす
  3. より小さいモデル（CogVideoX-2b）を使用
  4. データ型をfloat16に変更

- **ディスク容量不足エラーが発生した場合**:
  1. `app/inference/output`フォルダをクリーンアップ
  2. `app/inference/gradio_tmp`フォルダをクリーンアップ
  3. キャッシュフォルダ（`cache`）を削除（モデル再ダウンロードが必要）

